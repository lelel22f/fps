local settings = UserSettings():GetService("UserGameSettings")
local lighting = game:GetService("Lighting")
local terrain = workspace.Terrain
local players = game:GetService("Players")
local localPlayer = players.LocalPlayer
local runService = game:GetService("RunService")
local soundService = game:GetService("SoundService")

settings.SavedQualityLevel = Enum.SavedQualitySetting.QualityLevel1
settings.MasterVolume = 0

pcall(function()
    sethiddenproperty(lighting, "Technology", Enum.Technology.Compatibility)
end)

lighting.GlobalShadows = false
lighting.FogEnd = 9e9
lighting.Brightness = 0
lighting.EnvironmentSpecularScale = 0
lighting.EnvironmentDiffuseScale = 0
lighting.OutdoorAmbient = Color3.new(0.5, 0.5, 0.5)
lighting.ClockTime = 12

for _, v in ipairs(lighting:GetChildren()) do
    if v:IsA("PostEffect") or v:IsA("Sky") or v:IsA("Atmosphere") or v:IsA("Clouds") then
        v:Destroy()
    end
end

terrain.WaterWaveSize = 0
terrain.WaterWaveSpeed = 0
terrain.WaterReflectance = 0
terrain.WaterTransparency = 0

pcall(function()
    sethiddenproperty(terrain, "SmoothGrid", false)
end)

pcall(function()
    workspace.StreamingMinRadius = 0
    workspace.StreamingTargetRadius = 0
end)

pcall(function()
    soundService.Volume = 0
    soundService.AmbientReverb = Enum.ReverbType.NoReverb
end)

task.spawn(function()
    task.wait(2)
    local mapFolder = workspace:FindFirstChild("Map")
    if mapFolder then
        pcall(function()
            mapFolder:Destroy()
        end)
    end
    
    local platform = Instance.new("Part")
    platform.Name = "SafePlatform"
    platform.Size = Vector3.new(2048, 1, 2048)
    platform.Position = Vector3.new(0, -10, 0)
    platform.Anchored = true
    platform.Transparency = 1
    platform.CanCollide = true
    platform.Material = Enum.Material.SmoothPlastic
    platform.CastShadow = false
    platform.Parent = workspace
end)

local function optimizeObject(obj)
    local t = obj.ClassName

    if t == "ParticleEmitter" or t == "Trail" or t == "Smoke" or t == "Fire" 
        or t == "Sparkles" or t == "Beam" or t == "Explosion" then
        obj:Destroy()
        return
    end

    if t == "Sound" or t == "SoundGroup" then
        obj:Destroy()
        return
    end

    if obj:IsA("BasePart") then
        obj.CastShadow = false
        obj.Material = Enum.Material.SmoothPlastic
        obj.Reflectance = 0
        pcall(function()
            obj.CollisionFidelity = Enum.CollisionFidelity.Box
        end)
        return
    end

    if t == "PointLight" or t == "SpotLight" or t == "SurfaceLight" then
        obj:Destroy()
        return
    end

    if t == "Humanoid" then
        obj.DisplayDistanceType = Enum.HumanoidDisplayDistanceType.None
        return
    end

    if t == "Decal" or t == "Texture" then
        obj:Destroy()
        return
    end
end

task.spawn(function()
    local count = 0
    for _, obj in ipairs(workspace:GetDescendants()) do
        pcall(function()
            optimizeObject(obj)
        end)
        count += 1
        if count % 100 == 0 then
            task.wait()
        end
    end
end)

workspace.DescendantAdded:Connect(function(obj)
    task.defer(function()
        pcall(function()
            optimizeObject(obj)
        end)
    end)
end)

local function optimizeLocalCharacter(char)
    task.spawn(function()
        for _, v in ipairs(char:GetDescendants()) do
            if v:IsA("Accessory") or v:IsA("Hat") or v:IsA("Shirt") 
                or v:IsA("Pants") or v:IsA("ShirtGraphic") 
                or v:IsA("CharacterMesh") or v:IsA("BodyColors") then
                v:Destroy()
            end
        end
    end)
end

if localPlayer.Character then
    optimizeLocalCharacter(localPlayer.Character)
end

localPlayer.CharacterAdded:Connect(optimizeLocalCharacter)

local function optimizeGui(v)
    if v:IsA("ImageLabel") or v:IsA("ImageButton") then
        v.ImageTransparency = 1
        v.Image = ""
    elseif v:IsA("VideoFrame") then
        v.Video = ""
    elseif v:IsA("ViewportFrame") then
        v.CurrentCamera = nil
    end
end

task.spawn(function()
    for _, v in ipairs(localPlayer.PlayerGui:GetDescendants()) do
        pcall(function()
            optimizeGui(v)
        end)
    end
end)

localPlayer.PlayerGui.DescendantAdded:Connect(function(v)
    task.defer(function()
        pcall(function()
            optimizeGui(v)
        end)
    end)
end)

setfpscap(20)

task.spawn(function()
    task.wait(1)
    pcall(function()
        local cam = workspace.CurrentCamera
        if cam then
            cam.CameraType = Enum.CameraType.Scriptable
            cam.CFrame = CFrame.new(0, 9e9, 0)
            cam.FieldOfView = 1
        end
    end)
    pcall(function()
        runService:Set3dRenderingEnabled(false)
    end)
end)

task.spawn(function()
    task.wait(30)
    pcall(function()
        runService:Set3dRenderingEnabled(true)
    end)
    task.wait(2)
    pcall(function()
        game:GetService("TeleportService"):Teleport(game.PlaceId)
    end)
end)

print("FPS ok")
